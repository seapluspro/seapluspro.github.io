<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CppKnife: The Search Engine</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CppKnife
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">The Search Engine </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md194"></a>
Table of Content</h1>
<h1><a class="anchor" id="autotoc_md195"></a>
Content</h1>
<ul>
<li><a href="#The Purpose">The Purpose</a></li>
<li><a href="#Script Engine Process">Script Engine Process</a></li>
<li><a href="#File Structure">Script File Structure</a></li>
<li><a href="#Buffers">Buffers</a></li>
<li><a href="#Variables">Variables</a></li>
<li><a href="#String Constants">String Constants</a></li>
<li><a href="#Positions">Positions</a></li>
<li><a href="#Range">Range</a></li>
<li><a href="#Conditions">Conditions</a></li>
<li><a href="#Statements">Statements</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md196"></a>
Content of External Documents</h1>
<ul>
<li><a class="el" href="md_doc_basic_statements.html">Basic statements</a><ul>
<li>assert</li>
<li>Assignment</li>
<li>leave</li>
<li>if else endif</li>
<li>script endscript</li>
<li>stop</li>
<li>while endwhile</li>
</ul>
</li>
<li><a class="el" href="md_doc_file_statements.html">File and buffer related statements</a><ul>
<li>copy</li>
<li>delete</li>
<li>load</li>
<li>log</li>
<li>select</li>
<li>store</li>
</ul>
</li>
<li><a class="el" href="md_doc_search_statements.html">Search and replace related statements</a><ul>
<li>mark</li>
<li>move</li>
<li>replace</li>
</ul>
</li>
<li><a class="el" href="md_doc_functions.html">Functions</a><ul>
<li>Scope "buffer"</li>
<li>Scope "math"</li>
<li>Scope "os"</li>
<li>Scope "string"</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md197"></a>
The Purpose</h1>
<p>The script engine implements an interpreter of a text search and manipulation language. The language knows variables, sub scripts, and control statements if and while.</p>
<h1><a class="anchor" id="autotoc_md198"></a>
Script Engine Process</h1>
<p>The engine reads a script file and interprets that line by line.</p>
<p>It is modular: An script can call other scripts. You can define also scripts inside a script.</p>
<h1><a class="anchor" id="autotoc_md199"></a>
Script File Structure</h1>
<p>The file is a sequence of statements, empty lines and comments.</p>
<ul>
<li>An <b>empty line</b> is a line containing whitespaces only.</li>
<li>A <b>comment</b> is a line starting with '#'.</li>
<li>A <b>statement</b> owns always a startline and possibly more following lines.<ul>
<li>A startline starts with a key word (name of the statement) followed by parameters divided by blanks.</li>
<li>The key word can be preceeded by whitespaces.</li>
<li>A following line starts with the '+'. Note: the '+' is not part of the content.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md200"></a>
Buffers</h1>
<ul>
<li>A buffer is a amount of lines.</li>
<li>A buffer has a name (alphanumeric) and a content (a list of lines)</li>
<li>Each script can have any number of local buffers.</li>
<li>There are any number of global buffers. The name of the global buffers starts with '_'.</li>
<li>The content of a buffer can be addressed in the script by ~&lt;name&gt;</li>
<li>Additionally a part of a buffer can be addressed:<ul>
<li>a single line: ~&lt;name&gt;:&lt;line_number&gt;</li>
<li>line numbers starts with 1</li>
<li>a range of lines: ~&lt;name&gt;:&lt;start&gt;-&lt;end&gt; The end line is included. if &lt;end&gt; &lt; 0: it is relative to the end. -1: last line</li>
<li>a range of lines: ~&lt;name&gt;:&lt;start&gt;:&amp;lt&lt;count&gt;</li>
<li>&lt;start&gt; is a start position</li>
<li>&lt;end&gt; is an end position (exclusive)</li>
<li>&lt;count&gt; is the number of lines</li>
<li>It is no error to specify more lines than available.</li>
</ul>
</li>
<li>The context defines whether the buffer name is meaned or the buffer contents.</li>
</ul>
<p>There are builtin buffers:</p><ul>
<li>~_main: the main text buffer of the search engine</li>
</ul>
<h2><a class="anchor" id="autotoc_md201"></a>
Examples</h2>
<p>load ~csv "data.csv" log ~csv:1-3 log ~csv::</p>
<h1><a class="anchor" id="autotoc_md202"></a>
Variables</h1>
<p>Variables are "named values". There are local variables, only known and accessible in the script, and global variables, accessable in all scripts. Global variables starts with "$_".</p><ul>
<li>A variable has a name (alphanumeric).</li>
<li>A variable stores a simple value, e.g a line number.</li>
<li>The value of the variable is expressed by $(&lt;name&gt;).</li>
<li>If the statement name ends with "!" the variable can be in any position of a statement. It will be replaced by its value before the statement is interpreted.</li>
<li>A variable will be defined by the assignment statement: <b>&lt;name&gt; = &lt;text&gt;</b> or <b>&lt;name&gt; := &lt;numeric-expression&gt;</b></li>
</ul>
<h2><a class="anchor" id="autotoc_md203"></a>
Predefined Variables:</h2>
<p><b>*Note</b>: the predefined global variables starts with two underlines.</p>
<ul>
<li>: the current line (1-based): 1..N</li>
<li>: the current line (0-based): 0..N-1</li>
<li>: the current column (1-based: 1..M</li>
<li>: the current column (0-based): 0..M-1</li>
<li>: the count of lines of the current buffer</li>
<li>: the current position, e.g. "3:29"</li>
<li>: the current mark, e.g. "24:3"</li>
<li>: the start position of the last search. Undefined if no hit.</li>
<li>: the position behind the last search. Undefined if no hit.</li>
<li>: the result of the last search statement: empty string if not found, the found string otherwise</li>
<li>: the length of . 0 if there was no hit.</li>
<li>: the name of the current buffer</li>
<li>: the filename of the current buffer</li>
<li>: the current date, e.g. 2023.01.25</li>
<li>: the current time, e.g. 22:44</li>
</ul>
<h2><a class="anchor" id="autotoc_md204"></a>
Interpreted script lines</h2>
<p>The lines in the script may contain variable names in any position. That will be replaced by the value of the variable before the "normal" processing of the line starts. This is named <b>interpretation of the line</b>.</p>
<ul>
<li>Numeric assignments are always interpreted.</li>
<li>To switch on interpretation a '!' must be set at the end of the command name.</li>
<li>Using '!!' as suffix means "use a numerical context": if the variable is empty or the variable does not exist: '0' is replaced. That is neccessary for a correct syntax. The numeric assignment automatically uses the numerical context.</li>
</ul>
<p>Examples: log! "the buffer has $(_lines) lines"  :=  +  + 2 if!!  &gt; 0 move!! :0 endif</p>
<h1><a class="anchor" id="autotoc_md205"></a>
String Constants</h1>
<ul>
<li>A string constant is a starting delimiter, the content and the trailing delimiter.</li>
<li>Starting and trailing delimiters must be equal.</li>
<li>The content must not contain the delimiter.</li>
</ul>
<h2><a class="anchor" id="autotoc_md206"></a>
Examples</h2>
<p>"Hello world" /a second string with " and ' inside/</p>
<h1><a class="anchor" id="autotoc_md207"></a>
Search String</h1>
<p>There are different possibilities to define a search string:</p>
<ul>
<li>s&lt;delimiter&gt;fix_string&lt;delimiter&gt;&lt;flags&gt;: There are no meta characters.</li>
<li>r&lt;delimiter&gt;fix_string&lt;delimiter&gt;&lt;flags&gt;: a regular expression</li>
<li>m&lt;delimiter&gt;fix_string&lt;delimiter&gt;&lt;flags&gt;: a expression used in shells: '*' means any string '?' a single char.</li>
</ul>
<p>Flags:</p>
<ul>
<li><b>i</b>: ignore case</li>
<li><b>L</b>: searches only in the current line</li>
<li><b>B</b>: searches backwards</li>
<li><b>T</b>: do not change the current position ("temporary")</li>
<li>__^__: starts the search at the begin of the current line</li>
<li><b>$</b>: starts the search at the end of the current line</li>
<li>__&lt;__: starts the search at the begin of the buffer</li>
<li>__&gt;__: starts the search at the end of the buffer</li>
</ul>
<p><b>Search and current position:</b></p>
<p>If the search starts at the current position (unless one of the flags ^, &lt; &gt; are used). If the search is successful the current position is set behind the found hit (unless the flag <b>T</b> (temporary) is used). If the search is not successful the position remains unchanged.</p>
<h2><a class="anchor" id="autotoc_md208"></a>
Examples</h2>
<p>s"Title"iT r/the\s*title!?/i^ m!The*itle!B</p>
<h2><a class="anchor" id="autotoc_md209"></a>
Backward Searches</h2>
<p>When the flag <b>B</b> is used the search is done on the lines below the current position. If the string is not found, the current position is not changed.</p>
<h2><a class="anchor" id="autotoc_md210"></a>
Inline Searches</h2>
<p>When the flag <b>L</b> is used the search is done only in the current line.</p>
<h1><a class="anchor" id="autotoc_md211"></a>
Position and Mark</h1>
<p>A position is a location in a buffer, specified by:</p>
<ul>
<li>an absolute line number, starting with 1, e.g. 255</li>
<li>a relative line number: a sign and a linenumber, e.g. -2, +7</li>
<li>a search string defined in a condition ("if" or "while") or the search command</li>
</ul>
<p>The position can be stored in a variable: Than the format is &lt;line&gt;:&lt;column&gt;, for example "344:12".</p>
<p>There is a special positon named <b>mark</b>. Some commands operate from that mark to the current position.</p>
<h1><a class="anchor" id="autotoc_md212"></a>
Text</h1>
<p>A text is:</p><ul>
<li>a buffer content: see above, e.g. ~&lt;buffername&gt;:1-3</li>
<li>a string constant: see above, e.g. "Hello world"</li>
</ul>
<h1><a class="anchor" id="autotoc_md213"></a>
Conditions</h1>
<p>The <b>if</b> and the <b>while</b> statement uses a condition. That may be a</p>
<ul>
<li>A search expression: The value is <b>true</b> if the search condition has been found: Starting search at the current position. If the search is successful the current position is behind the found hit. If the search is not successful the position remains unchanged.</li>
<li>A comparison: Two operands and a operator between that. Example  &lt; 3<ul>
<li>numeric operators: == != &lt; &lt;= &gt; &gt;=</li>
<li>string operators: -eq -ne -lt -le -gt -ge: equal, "not equal" "lower than" "lower equal" "greater than" "greater equal"</li>
</ul>
</li>
<li>A single value:<ul>
<li>A number: 0 means false, otherwise means <b>true</b>.</li>
<li>A string: "" (empty string) means false, otherwise means <b>true</b>. </li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
